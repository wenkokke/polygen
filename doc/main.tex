%% For double-blind review submission, w/o CCS and ACM Reference (max submission space)
\documentclass[sigplan,10pt,review,anonymous]{acmart}\settopmatter{printfolios=true,printccs=false,printacmref=false}

%% Conference information
\acmConference[PLDI'21]{ACM SIGPLAN Conference on Programming Language Design and Implementation}{June 20--25, 2021}{Virtual Conference}
\acmYear{2018}
\acmISBN{}
\acmDOI{}
\startPage{1}

%% Copyright information
\setcopyright{none}
%\setcopyright{acmcopyright}
%\setcopyright{acmlicensed}
%\setcopyright{rightsretained}

%% Bibliography style
\bibliographystyle{ACM-Reference-Format}
\citestyle{acmauthoryear}  %% For author/year citations

%% Preamble.
\usepackage{comment}
\usepackage{textgreek}
\let\Bbbk\undefined
%% ODER: format ==         = "\mathrel{==}"
%% ODER: format /=         = "\neq "
%
%
\makeatletter
\@ifundefined{lhs2tex.lhs2tex.sty.read}%
  {\@namedef{lhs2tex.lhs2tex.sty.read}{}%
   \newcommand\SkipToFmtEnd{}%
   \newcommand\EndFmtInput{}%
   \long\def\SkipToFmtEnd#1\EndFmtInput{}%
  }\SkipToFmtEnd

\newcommand\ReadOnlyOnce[1]{\@ifundefined{#1}{\@namedef{#1}{}}\SkipToFmtEnd}
\usepackage{amstext}
\usepackage{amssymb}
\usepackage{stmaryrd}
\DeclareFontFamily{OT1}{cmtex}{}
\DeclareFontShape{OT1}{cmtex}{m}{n}
  {<5><6><7><8>cmtex8
   <9>cmtex9
   <10><10.95><12><14.4><17.28><20.74><24.88>cmtex10}{}
\DeclareFontShape{OT1}{cmtex}{m}{it}
  {<-> ssub * cmtt/m/it}{}
\newcommand{\texfamily}{\fontfamily{cmtex}\selectfont}
\DeclareFontShape{OT1}{cmtt}{bx}{n}
  {<5><6><7><8>cmtt8
   <9>cmbtt9
   <10><10.95><12><14.4><17.28><20.74><24.88>cmbtt10}{}
\DeclareFontShape{OT1}{cmtex}{bx}{n}
  {<-> ssub * cmtt/bx/n}{}
\newcommand{\tex}[1]{\text{\texfamily#1}}	% NEU

\newcommand{\Sp}{\hskip.33334em\relax}


\newcommand{\Conid}[1]{\mathit{#1}}
\newcommand{\Varid}[1]{\mathit{#1}}
\newcommand{\anonymous}{\kern0.06em \vbox{\hrule\@width.5em}}
\newcommand{\plus}{\mathbin{+\!\!\!+}}
\newcommand{\bind}{\mathbin{>\!\!\!>\mkern-6.7mu=}}
\newcommand{\rbind}{\mathbin{=\mkern-6.7mu<\!\!\!<}}% suggested by Neil Mitchell
\newcommand{\sequ}{\mathbin{>\!\!\!>}}
\renewcommand{\leq}{\leqslant}
\renewcommand{\geq}{\geqslant}
\usepackage{polytable}

%mathindent has to be defined
\@ifundefined{mathindent}%
  {\newdimen\mathindent\mathindent\leftmargini}%
  {}%

\def\resethooks{%
  \global\let\SaveRestoreHook\empty
  \global\let\ColumnHook\empty}
\newcommand*{\savecolumns}[1][default]%
  {\g@addto@macro\SaveRestoreHook{\savecolumns[#1]}}
\newcommand*{\restorecolumns}[1][default]%
  {\g@addto@macro\SaveRestoreHook{\restorecolumns[#1]}}
\newcommand*{\aligncolumn}[2]%
  {\g@addto@macro\ColumnHook{\column{#1}{#2}}}

\resethooks

\newcommand{\onelinecommentchars}{\quad-{}- }
\newcommand{\commentbeginchars}{\enskip\{-}
\newcommand{\commentendchars}{-\}\enskip}

\newcommand{\visiblecomments}{%
  \let\onelinecomment=\onelinecommentchars
  \let\commentbegin=\commentbeginchars
  \let\commentend=\commentendchars}

\newcommand{\invisiblecomments}{%
  \let\onelinecomment=\empty
  \let\commentbegin=\empty
  \let\commentend=\empty}

\visiblecomments

\newlength{\blanklineskip}
\setlength{\blanklineskip}{0.66084ex}

\newcommand{\hsindent}[1]{\quad}% default is fixed indentation
\let\hspre\empty
\let\hspost\empty
\newcommand{\NB}{\textbf{NB}}
\newcommand{\Todo}[1]{$\langle$\textbf{To do:}~#1$\rangle$}

\EndFmtInput
\makeatother
%

\begin{document}

\title{PolyGen}

\author{Wen Kokke}
\affiliation{
  \institution{University of Edinburgh}
  \country{United Kingdom}
}
\email{wen.kokke@ed.ac.uk}

%% TODO: Add yourself...


%% Abstract
\begin{abstract}
Text of abstract \ldots.
\end{abstract}


%% 2012 ACM Computing Classification System (CSS) concepts
%% Generate at 'http://dl.acm.org/ccs/ccs.cfm'.
\begin{CCSXML}\begingroup\par\noindent\advance\leftskip\mathindent\(
\begin{pboxed}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\Varid{ccs2012}\mathbin{>}{}\<[E]%
\\
\>[B]{}\Varid{concept}\mathbin{>}{}\<[E]%
\\
\>[B]{}\Varid{concept\char95 id}\mathbin{>}\mathrm{10011007.10011006}\mathbin{\circ}\mathrm{10011008}\mathbin{</}\Varid{concept\char95 id}\mathbin{>}{}\<[E]%
\\
\>[B]{}\Varid{concept\char95 desc}\mathbin{>}\Conid{Software}\;\Varid{and}\;\Varid{its}\;\Varid{engineering}\mathord{\sim}\Conid{General}\;\Varid{programming}\;\Varid{languages}\mathbin{</}\Varid{concept\char95 desc}\mathbin{>}{}\<[E]%
\\
\>[B]{}\Varid{concept\char95 significance}\mathbin{>}\mathrm{500}\mathbin{</}\Varid{concept\char95 significance}\mathbin{>}{}\<[E]%
\\
\>[B]{}\mathbin{/}\Varid{concept}\mathbin{>}{}\<[E]%
\\
\>[B]{}\Varid{concept}\mathbin{>}{}\<[E]%
\\
\>[B]{}\Varid{concept\char95 id}\mathbin{>}\mathrm{10003456.10003457}\mathbin{\circ}\mathrm{10003521.10003525}\mathbin{</}\Varid{concept\char95 id}\mathbin{>}{}\<[E]%
\\
\>[B]{}\Varid{concept\char95 desc}\mathbin{>}\Conid{Social}\;\Varid{and}\;\Varid{professional}\;\Varid{topics}\mathord{\sim}\Conid{History}\;\mathbf{of}\;\Varid{programming}\;\Varid{languages}\mathbin{</}\Varid{concept\char95 desc}\mathbin{>}{}\<[E]%
\\
\>[B]{}\Varid{concept\char95 significance}\mathbin{>}\mathrm{300}\mathbin{</}\Varid{concept\char95 significance}\mathbin{>}{}\<[E]%
\\
\>[B]{}\mathbin{/}\Varid{concept}\mathbin{>}{}\<[E]%
\\
\>[B]{}\mathbin{/}\Varid{ccs2012}\mathbin{>}{}\<[E]%
\ColumnHook
\end{pboxed}
\)\par\noindent\endgroup\resethooks
\end{CCSXML}

\ccsdesc[500]{Software and its engineering~General programming languages}
\ccsdesc[300]{Social and professional topics~History of programming languages}
%% End of generated code


%% Keywords
%% comma separated list
\keywords{keyword1, keyword2, keyword3}  %% \keywords are mandatory in final camera-ready submission

%% \maketitle
%% Note: \maketitle command must come after title commands, author
%% commands, abstract environment, Computing Classification System
%% environment and commands, and keywords command.
\maketitle

\section{PolyGen}


\begin{comment}
\begingroup\par\noindent\advance\leftskip\mathindent\(
\begin{pboxed}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\mbox{\enskip\{-\# LANGUAGE ApplicativeDo         \#-\}\enskip}{}\<[E]%
\\
\>[B]{}\mbox{\enskip\{-\# LANGUAGE DeriveAnyClass        \#-\}\enskip}{}\<[E]%
\\
\>[B]{}\mbox{\enskip\{-\# LANGUAGE DeriveDataTypeable    \#-\}\enskip}{}\<[E]%
\\
\>[B]{}\mbox{\enskip\{-\# LANGUAGE DeriveFunctor         \#-\}\enskip}{}\<[E]%
\\
\>[B]{}\mbox{\enskip\{-\# LANGUAGE EmptyCase             \#-\}\enskip}{}\<[E]%
\\
\>[B]{}\mbox{\enskip\{-\# LANGUAGE EmptyDataDeriving     \#-\}\enskip}{}\<[E]%
\\
\>[B]{}\mbox{\enskip\{-\# LANGUAGE FlexibleInstances     \#-\}\enskip}{}\<[E]%
\\
\>[B]{}\mbox{\enskip\{-\# LANGUAGE FlexibleContexts      \#-\}\enskip}{}\<[E]%
\\
\>[B]{}\mbox{\enskip\{-\# LANGUAGE PatternSynonyms       \#-\}\enskip}{}\<[E]%
\\
\>[B]{}\mbox{\enskip\{-\# LANGUAGE TemplateHaskell       \#-\}\enskip}{}\<[E]%
\\
\>[B]{}\mbox{\enskip\{-\# LANGUAGE UndecidableInstances  \#-\}\enskip}{}\<[E]%
\ColumnHook
\end{pboxed}
\)\par\noindent\endgroup\resethooks
\end{comment}


\begin{comment}
\begingroup\par\noindent\advance\leftskip\mathindent\(
\begin{pboxed}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\mathbf{import}\;\Conid{\Conid{Control}.Enumerable}{}\<[E]%
\\
\>[B]{}\mathbf{import}\;\Conid{\Conid{Control}.Search}{}\<[E]%
\\
\>[B]{}\mathbf{import}\;\Conid{\Conid{Control}.\Conid{Monad}.Reader}{}\<[E]%
\\
\>[B]{}\mathbf{import}\;\Conid{\Conid{Data}.Bifunctor}{}\<[E]%
\\
\>[B]{}\mathbf{import}\;\Conid{\Conid{Data}.\Conid{Bifunctor}.TH}{}\<[E]%
\\
\>[B]{}\mathbf{import}\;\Conid{\Conid{Data}.Coolean}{}\<[E]%
\\
\>[B]{}\mathbf{import}\;\Conid{\Conid{Data}.Maybe}{}\<[E]%
\\
\>[B]{}\mathbf{import}\;\Conid{\Conid{System}.Environment}{}\<[E]%
\ColumnHook
\end{pboxed}
\)\par\noindent\endgroup\resethooks
\end{comment}


\subsection{Terms}

\begingroup\par\noindent\advance\leftskip\mathindent\(
\begin{pboxed}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\mathbf{data}\;\Conid{Z}{}\<[E]%
\ColumnHook
\end{pboxed}
\)\par\noindent\endgroup\resethooks
\begin{comment}
\begingroup\par\noindent\advance\leftskip\mathindent\(
\begin{pboxed}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{3}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[3]{}\mathbf{deriving}\;(\Conid{Typeable},\Conid{Eq},\Conid{Read},\Conid{Show}){}\<[E]%
\ColumnHook
\end{pboxed}
\)\par\noindent\endgroup\resethooks
\end{comment}

\begingroup\par\noindent\advance\leftskip\mathindent\(
\begin{pboxed}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\mathbf{data}\;\Conid{S}\;\Varid{n}\mathrel{=}\Conid{FZ}\mid \Conid{FS}\;\Varid{n}{}\<[E]%
\ColumnHook
\end{pboxed}
\)\par\noindent\endgroup\resethooks
\begin{comment}
\begingroup\par\noindent\advance\leftskip\mathindent\(
\begin{pboxed}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{3}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[3]{}\mathbf{deriving}\;(\Conid{Typeable},\Conid{Eq},\Conid{Read},\Conid{Functor}){}\<[E]%
\ColumnHook
\end{pboxed}
\)\par\noindent\endgroup\resethooks
\end{comment}

\begingroup\par\noindent\advance\leftskip\mathindent\(
\begin{pboxed}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\Varid{fromZ}\mathbin{::}\Conid{Z}\to \Varid{a}{}\<[E]%
\\
\>[B]{}\Varid{fromZ}\;\Varid{n}\mathrel{=}\mathbf{case}\;\Varid{n}\;\mathbf{of}\;\{\mskip1.5mu \mskip1.5mu\}{}\<[E]%
\ColumnHook
\end{pboxed}
\)\par\noindent\endgroup\resethooks

\begingroup\par\noindent\advance\leftskip\mathindent\(
\begin{pboxed}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{19}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\Varid{fromS}\mathbin{::}\Varid{a}\to (\Varid{n}\to \Varid{a})\to \Conid{S}\;\Varid{n}\to \Varid{a}{}\<[E]%
\\
\>[B]{}\Varid{fromS}\;\Varid{z}\;\Varid{s}\;\Conid{FZ}{}\<[19]%
\>[19]{}\mathrel{=}\Varid{z}{}\<[E]%
\\
\>[B]{}\Varid{fromS}\;\Varid{z}\;\Varid{s}\;(\Conid{FS}\;\Varid{n}){}\<[19]%
\>[19]{}\mathrel{=}\Varid{s}\;\Varid{n}{}\<[E]%
\ColumnHook
\end{pboxed}
\)\par\noindent\endgroup\resethooks

\begin{comment}
\begingroup\par\noindent\advance\leftskip\mathindent\(
\begin{pboxed}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{3}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\mathbf{instance}\;\Conid{Enumerable}\;\Conid{Z}\;\mathbf{where}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\Varid{enumerate}\mathrel{=}\Varid{datatype}\;[\mskip1.5mu \mskip1.5mu]{}\<[E]%
\\[\blanklineskip]%
\>[B]{}\mathbf{instance}\;\Conid{Enumerable}\;\Varid{n}\Rightarrow \Conid{Enumerable}\;(\Conid{S}\;\Varid{n})\;\mathbf{where}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\Varid{enumerate}\mathrel{=}\Varid{share}\mathbin{\$}\Varid{aconcat}\;[\mskip1.5mu \Varid{c0}\;\Conid{FZ},\Varid{c1}\;\Conid{FS}\mskip1.5mu]{}\<[E]%
\ColumnHook
\end{pboxed}
\)\par\noindent\endgroup\resethooks
\end{comment}

\begin{comment}
\begingroup\par\noindent\advance\leftskip\mathindent\(
\begin{pboxed}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{3}{@{}>{\hspre}l<{\hspost}@{}}%
\column{16}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\mathbf{class}\;\Conid{Fin}\;\Varid{n}\;\mathbf{where}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\Varid{toInt}\mathbin{::}\Varid{n}\to \Conid{Int}{}\<[E]%
\\[\blanklineskip]%
\>[B]{}\mathbf{instance}\;\Conid{Fin}\;\Conid{Z}\;\mathbf{where}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\Varid{toInt}\mathrel{=}\Varid{fromZ}{}\<[E]%
\\[\blanklineskip]%
\>[B]{}\mathbf{instance}\;\Conid{Fin}\;\Varid{n}\Rightarrow \Conid{Fin}\;(\Conid{S}\;\Varid{n})\;\mathbf{where}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\Varid{toInt}\;\Conid{FZ}{}\<[16]%
\>[16]{}\mathrel{=}\mathrm{0}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\Varid{toInt}\;(\Conid{FS}\;\Varid{i})\mathrel{=}\Varid{succ}\;(\Varid{toInt}\;\Varid{i}){}\<[E]%
\\[\blanklineskip]%
\>[B]{}\mathbf{instance}\;\Conid{Fin}\;(\Conid{S}\;\Varid{n})\Rightarrow \Conid{Show}\;(\Conid{S}\;\Varid{n})\;\mathbf{where}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\Varid{show}\mathrel{=}\Varid{show}\mathbin{\circ}\Varid{toInt}{}\<[E]%
\ColumnHook
\end{pboxed}
\)\par\noindent\endgroup\resethooks
\end{comment}


\subsection{Kinds}

\begingroup\par\noindent\advance\leftskip\mathindent\(
\begin{pboxed}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{4}{@{}>{\hspre}c<{\hspost}@{}}%
\column{4E}{@{}l@{}}%
\column{7}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\mathbf{data}\;{}\<[7]%
\>[7]{}\Conid{Kind}{}\<[E]%
\\
\>[B]{}\hsindent{4}{}\<[4]%
\>[4]{}\mathrel{=}{}\<[4E]%
\>[7]{}\Conid{Star}{}\<[E]%
\\
\>[B]{}\hsindent{4}{}\<[4]%
\>[4]{}\mid {}\<[4E]%
\>[7]{}\Conid{Kind}:\Rightarrow\Conid{Kind}{}\<[E]%
\ColumnHook
\end{pboxed}
\)\par\noindent\endgroup\resethooks
\begin{comment}
\begingroup\par\noindent\advance\leftskip\mathindent\(
\begin{pboxed}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{3}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[3]{}\mathbf{deriving}\;(\Conid{Typeable},\Conid{Eq},\Conid{Read},\Conid{Show}){}\<[E]%
\ColumnHook
\end{pboxed}
\)\par\noindent\endgroup\resethooks
\end{comment}

\begin{comment}
\begingroup\par\noindent\advance\leftskip\mathindent\(
\begin{pboxed}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\Varid{deriveEnumerable}\;\text{\ttfamily ''}\;\Conid{Kind}{}\<[E]%
\ColumnHook
\end{pboxed}
\)\par\noindent\endgroup\resethooks
\end{comment}


\subsection{Types}

\begingroup\par\noindent\advance\leftskip\mathindent\(
\begin{pboxed}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{4}{@{}>{\hspre}c<{\hspost}@{}}%
\column{4E}{@{}l@{}}%
\column{7}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\mathbf{data}\;{}\<[7]%
\>[7]{}\Conid{Type}\;\Varid{ty}{}\<[E]%
\\
\>[B]{}\hsindent{4}{}\<[4]%
\>[4]{}\mathrel{=}{}\<[4E]%
\>[7]{}\Conid{TyVoid}{}\<[E]%
\\
\>[B]{}\hsindent{4}{}\<[4]%
\>[4]{}\mid {}\<[4E]%
\>[7]{}\Conid{Type}\;\Varid{ty}:\rightarrow\Conid{Type}\;\Varid{ty}{}\<[E]%
\\
\>[B]{}\hsindent{4}{}\<[4]%
\>[4]{}\mid {}\<[4E]%
\>[7]{}\Conid{TyForall}\;\Conid{Kind}\;(\Conid{Type}\;(\Conid{S}\;\Varid{ty})){}\<[E]%
\\
\>[B]{}\hsindent{4}{}\<[4]%
\>[4]{}\mid {}\<[4E]%
\>[7]{}\Conid{TyVar}\;\Varid{ty}{}\<[E]%
\\
\>[B]{}\hsindent{4}{}\<[4]%
\>[4]{}\mid {}\<[4E]%
\>[7]{}\Conid{TyLam}\;(\Conid{Type}\;(\Conid{S}\;\Varid{ty})){}\<[E]%
\\
\>[B]{}\hsindent{4}{}\<[4]%
\>[4]{}\mid {}\<[4E]%
\>[7]{}\Conid{TyApp}\;(\Conid{Type}\;\Varid{ty})\;(\Conid{Type}\;\Varid{ty})\;\Conid{Kind}{}\<[E]%
\ColumnHook
\end{pboxed}
\)\par\noindent\endgroup\resethooks
\begin{comment}
\begingroup\par\noindent\advance\leftskip\mathindent\(
\begin{pboxed}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{3}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[3]{}\mathbf{deriving}\;(\Conid{Typeable},\Conid{Eq},\Conid{Read},\Conid{Show},\Conid{Functor}){}\<[E]%
\ColumnHook
\end{pboxed}
\)\par\noindent\endgroup\resethooks
\end{comment}

\begin{comment}
\begingroup\par\noindent\advance\leftskip\mathindent\(
\begin{pboxed}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\Varid{deriveEnumerable}\;\text{\ttfamily ''}\;\Conid{Type}{}\<[E]%
\ColumnHook
\end{pboxed}
\)\par\noindent\endgroup\resethooks
\end{comment}


\begingroup\par\noindent\advance\leftskip\mathindent\(
\begin{pboxed}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\mathbf{newtype}\;\Conid{Normal}\;\Varid{a}\mathrel{=}\Conid{Normal}\;\{\mskip1.5mu \Varid{unNormal}\mathbin{::}\Varid{a}\mskip1.5mu\}{}\<[E]%
\ColumnHook
\end{pboxed}
\)\par\noindent\endgroup\resethooks
\begin{comment}
\begingroup\par\noindent\advance\leftskip\mathindent\(
\begin{pboxed}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{3}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[3]{}\mathbf{deriving}\;(\Conid{Typeable},\Conid{Eq},\Conid{Functor}){}\<[E]%
\\[\blanklineskip]%
\>[B]{}\mathbf{instance}\;\Conid{Show}\;\Varid{a}\Rightarrow \Conid{Show}\;(\Conid{Normal}\;\Varid{a})\;\mathbf{where}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\Varid{showsPrec}\;\Varid{d}\;\Varid{a}\mathrel{=}\Varid{showsPrec}\;\Varid{d}\;(\Varid{unNormal}\;\Varid{a}){}\<[E]%
\ColumnHook
\end{pboxed}
\)\par\noindent\endgroup\resethooks
\end{comment}

\begin{comment}
\begingroup\par\noindent\advance\leftskip\mathindent\(
\begin{pboxed}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{3}{@{}>{\hspre}l<{\hspost}@{}}%
\column{5}{@{}>{\hspre}l<{\hspost}@{}}%
\column{14}{@{}>{\hspre}l<{\hspost}@{}}%
\column{18}{@{}>{\hspre}l<{\hspost}@{}}%
\column{24}{@{}>{\hspre}c<{\hspost}@{}}%
\column{24E}{@{}l@{}}%
\column{28}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\mathbf{instance}\;\Conid{Enumerable}\;\Varid{ty}\Rightarrow \Conid{Enumerable}\;(\Conid{Normal}\;(\Conid{Type}\;\Varid{ty}))\;\mathbf{where}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\Varid{enumerate}\mathrel{=}\Varid{share}\mathbin{\$}\Varid{aconcat}{}\<[E]%
\\
\>[3]{}\hsindent{2}{}\<[5]%
\>[5]{}[\mskip1.5mu {}\<[14]%
\>[14]{}\Varid{c1}{}\<[18]%
\>[18]{}\mathbin{\$}\lambda \Varid{a}{}\<[24]%
\>[24]{}\to {}\<[24E]%
\>[28]{}\Conid{Normal}\;(\Varid{unNeutral}\;\Varid{a}){}\<[E]%
\\
\>[3]{}\hsindent{2}{}\<[5]%
\>[5]{},\Varid{pay}\mathbin{\circ}{}\<[14]%
\>[14]{}\Varid{c1}{}\<[18]%
\>[18]{}\mathbin{\$}\lambda \Varid{a}{}\<[24]%
\>[24]{}\to {}\<[24E]%
\>[28]{}\Conid{Normal}\;(\Conid{TyLam}\;(\Varid{unNormal}\;\Varid{a})){}\<[E]%
\\
\>[3]{}\hsindent{2}{}\<[5]%
\>[5]{}\mskip1.5mu]{}\<[E]%
\ColumnHook
\end{pboxed}
\)\par\noindent\endgroup\resethooks
\end{comment}


\begingroup\par\noindent\advance\leftskip\mathindent\(
\begin{pboxed}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\mathbf{newtype}\;\Conid{Neutral}\;\Varid{a}\mathrel{=}\Conid{Neutral}\;\{\mskip1.5mu \Varid{unNeutral}\mathbin{::}\Varid{a}\mskip1.5mu\}{}\<[E]%
\ColumnHook
\end{pboxed}
\)\par\noindent\endgroup\resethooks
\begin{comment}
\begingroup\par\noindent\advance\leftskip\mathindent\(
\begin{pboxed}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{3}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[3]{}\mathbf{deriving}\;(\Conid{Typeable},\Conid{Eq},\Conid{Functor}){}\<[E]%
\\[\blanklineskip]%
\>[B]{}\mathbf{instance}\;\Conid{Show}\;\Varid{a}\Rightarrow \Conid{Show}\;(\Conid{Neutral}\;\Varid{a})\;\mathbf{where}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\Varid{showsPrec}\;\Varid{d}\;\Varid{a}\mathrel{=}\Varid{showsPrec}\;\Varid{d}\;(\Varid{unNeutral}\;\Varid{a}){}\<[E]%
\ColumnHook
\end{pboxed}
\)\par\noindent\endgroup\resethooks
\end{comment}


\begin{comment}
\begingroup\par\noindent\advance\leftskip\mathindent\(
\begin{pboxed}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{3}{@{}>{\hspre}l<{\hspost}@{}}%
\column{5}{@{}>{\hspre}c<{\hspost}@{}}%
\column{5E}{@{}l@{}}%
\column{8}{@{}>{\hspre}l<{\hspost}@{}}%
\column{15}{@{}>{\hspre}l<{\hspost}@{}}%
\column{19}{@{}>{\hspre}l<{\hspost}@{}}%
\column{29}{@{}>{\hspre}c<{\hspost}@{}}%
\column{29E}{@{}l@{}}%
\column{33}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\mathbf{instance}\;\Conid{Enumerable}\;\Varid{ty}\Rightarrow \Conid{Enumerable}\;(\Conid{Neutral}\;(\Conid{Type}\;\Varid{ty}))\;\mathbf{where}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\Varid{enumerate}\mathrel{=}\Varid{share}\mathbin{\$}\Varid{aconcat}{}\<[E]%
\\
\>[3]{}\hsindent{2}{}\<[5]%
\>[5]{}[\mskip1.5mu {}\<[5E]%
\>[8]{}\Varid{pay}\mathbin{\circ}{}\<[15]%
\>[15]{}\Varid{c0}{}\<[19]%
\>[19]{}\mathbin{\$}{}\<[33]%
\>[33]{}\Conid{Neutral}\;\Conid{TyVoid}{}\<[E]%
\\
\>[3]{}\hsindent{2}{}\<[5]%
\>[5]{},{}\<[5E]%
\>[8]{}\Varid{pay}\mathbin{\circ}{}\<[15]%
\>[15]{}\Varid{c2}{}\<[19]%
\>[19]{}\mathbin{\$}\lambda \Varid{a}\;\Varid{b}{}\<[29]%
\>[29]{}\to {}\<[29E]%
\>[33]{}\Conid{Neutral}\;(\Varid{unNeutral}\;\Varid{a}:\rightarrow\Varid{unNeutral}\;\Varid{b}){}\<[E]%
\\
\>[3]{}\hsindent{2}{}\<[5]%
\>[5]{},{}\<[5E]%
\>[8]{}\Varid{pay}\mathbin{\circ}{}\<[15]%
\>[15]{}\Varid{c2}{}\<[19]%
\>[19]{}\mathbin{\$}\lambda \Varid{k}\;\Varid{a}{}\<[29]%
\>[29]{}\to {}\<[29E]%
\>[33]{}\Conid{Neutral}\;(\Conid{TyForall}\;\Varid{k}\;(\Varid{unNeutral}\;\Varid{a})){}\<[E]%
\\
\>[3]{}\hsindent{2}{}\<[5]%
\>[5]{},{}\<[5E]%
\>[8]{}\Varid{pay}\mathbin{\circ}{}\<[15]%
\>[15]{}\Varid{c1}{}\<[19]%
\>[19]{}\mathbin{\$}\lambda \Varid{i}{}\<[29]%
\>[29]{}\to {}\<[29E]%
\>[33]{}\Conid{Neutral}\;(\Conid{TyVar}\;\Varid{i}){}\<[E]%
\\
\>[3]{}\hsindent{2}{}\<[5]%
\>[5]{},{}\<[5E]%
\>[8]{}\Varid{pay}\mathbin{\circ}{}\<[15]%
\>[15]{}\Varid{c3}{}\<[19]%
\>[19]{}\mathbin{\$}\lambda \Varid{a}\;\Varid{b}\;\Varid{k}{}\<[29]%
\>[29]{}\to {}\<[29E]%
\>[33]{}\Conid{Neutral}\;(\Conid{TyApp}\;(\Varid{unNeutral}\;\Varid{a})\;(\Varid{unNormal}\;\Varid{b})\;\Varid{k}){}\<[E]%
\\
\>[3]{}\hsindent{2}{}\<[5]%
\>[5]{}\mskip1.5mu]{}\<[5E]%
\ColumnHook
\end{pboxed}
\)\par\noindent\endgroup\resethooks
\end{comment}


\subsection{Kind Checking}

\begingroup\par\noindent\advance\leftskip\mathindent\(
\begin{pboxed}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\mathbf{type}\;\Conid{KindEnv}\;\Varid{ty}\mathrel{=}\Varid{ty}\to \Conid{Kind}{}\<[E]%
\ColumnHook
\end{pboxed}
\)\par\noindent\endgroup\resethooks

\begingroup\par\noindent\advance\leftskip\mathindent\(
\begin{pboxed}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{28}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\Varid{ext}_{\Varid{KindEnv}}\mathbin{::}\Conid{Kind}\to \Conid{KindEnv}\;\Varid{ty}\to \Conid{KindEnv}\;(\Conid{S}\;\Varid{ty}){}\<[E]%
\\
\>[B]{}\Varid{ext}_{\Varid{KindEnv}}\;\Varid{k}\;\Varid{kindOf}\;\Conid{FZ}{}\<[28]%
\>[28]{}\mathrel{=}\Varid{k}{}\<[E]%
\\
\>[B]{}\Varid{ext}_{\Varid{KindEnv}}\;\Varid{k}\;\Varid{kindOf}\;(\Conid{FS}\;\Varid{i})\mathrel{=}\Varid{kindOf}\;\Varid{i}{}\<[E]%
\ColumnHook
\end{pboxed}
\)\par\noindent\endgroup\resethooks

\begingroup\par\noindent\advance\leftskip\mathindent\(
\begin{pboxed}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{3}{@{}>{\hspre}l<{\hspost}@{}}%
\column{5}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\Varid{check}_{\Varid{Ty}}\mathbin{::}\Conid{Kind}\to \Conid{Type}\;\Varid{ty}\to \Conid{Reader}\;(\Conid{KindEnv}\;\Varid{ty})\;\Conid{Cool}{}\<[E]%
\\
\>[B]{}\Varid{check}_{\Varid{Ty}}\;\Conid{Star}\;\Conid{TyVoid}\mathrel{=}\Varid{pure}\;\Varid{True}{}\<[E]%
\\
\>[B]{}\Varid{check}_{\Varid{Ty}}\;\Conid{Star}\;(\Varid{a}:\rightarrow\Varid{b})\mathrel{=}\mathbf{do}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\Varid{aOk}\leftarrow \Varid{check}_{\Varid{Ty}}\;\Conid{Star}\;\Varid{a}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\Varid{bOk}\leftarrow \Varid{check}_{\Varid{Ty}}\;\Conid{Star}\;\Varid{b}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\Varid{return}\;(\Varid{aOk}\land\Varid{bOk}){}\<[E]%
\\
\>[B]{}\Varid{check}_{\Varid{Ty}}\;\Conid{Star}\;(\Conid{TyForall}\;\Varid{k}\;\Varid{a})\mathrel{=}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\Varid{withReader}\;(\Varid{ext}_{\Varid{KindEnv}}\;\Varid{k})\;(\Varid{check}_{\Varid{Ty}}\;\Conid{Star}\;\Varid{a}){}\<[E]%
\\
\>[B]{}\Varid{check}_{\Varid{Ty}}\;\Varid{k}\;(\Conid{TyVar}\;\Varid{i})\mathrel{=}\mathbf{do}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\Varid{kindOf}\leftarrow \Varid{ask}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\Varid{return}\;(\Varid{toCool}\;(\Varid{k}\equiv \Varid{kindOf}\;\Varid{i})){}\<[E]%
\\
\>[B]{}\Varid{check}_{\Varid{Ty}}\;(\Varid{k}:\Rightarrow\Varid{k'})\;(\Conid{TyLam}\;\Varid{a})\mathrel{=}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\Varid{withReader}\;(\Varid{ext}_{\Varid{KindEnv}}\;\Varid{k})\mathbin{\$}{}\<[E]%
\\
\>[3]{}\hsindent{2}{}\<[5]%
\>[5]{}\Varid{check}_{\Varid{Ty}}\;\Varid{k'}\;\Varid{a}{}\<[E]%
\\
\>[B]{}\Varid{check}_{\Varid{Ty}}\;\Varid{k'}\;(\Conid{TyApp}\;\Varid{a}\;\Varid{b}\;\Varid{k})\mathrel{=}\mathbf{do}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\Varid{aOk}\leftarrow \Varid{check}_{\Varid{Ty}}\;(\Varid{k}:\Rightarrow\Varid{k'})\;\Varid{a}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\Varid{bOk}\leftarrow \Varid{check}_{\Varid{Ty}}\;\Varid{k'}\;\Varid{b}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\Varid{return}\;(\Varid{aOk}\land\Varid{bOk}){}\<[E]%
\\
\>[B]{}\Varid{check}_{\Varid{Ty}}\;\anonymous \;\anonymous \mathrel{=}\Varid{pure}\;\Varid{False}{}\<[E]%
\ColumnHook
\end{pboxed}
\)\par\noindent\endgroup\resethooks


\subsection{Type Normalisation}

\begingroup\par\noindent\advance\leftskip\mathindent\(
\begin{pboxed}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\mathbf{type}\;\Conid{TySub}\;\Varid{ty}\;\Varid{ty'}\mathrel{=}\Varid{ty}\to \Conid{Type}\;\Varid{ty'}{}\<[E]%
\ColumnHook
\end{pboxed}
\)\par\noindent\endgroup\resethooks

\begingroup\par\noindent\advance\leftskip\mathindent\(
\begin{pboxed}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{20}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\Varid{ext}_{\Varid{TySub}}\mathbin{::}\Conid{TySub}\;\Varid{ty}\;\Varid{ty'}\to \Conid{TySub}\;(\Conid{S}\;\Varid{ty})\;(\Conid{S}\;\Varid{ty'}){}\<[E]%
\\
\>[B]{}\Varid{ext}_{\Varid{TySub}}\;\Varid{s}\;\Conid{FZ}{}\<[20]%
\>[20]{}\mathrel{=}\Conid{TyVar}\;\Conid{FZ}{}\<[E]%
\\
\>[B]{}\Varid{ext}_{\Varid{TySub}}\;\Varid{s}\;(\Conid{FS}\;\Varid{i}){}\<[20]%
\>[20]{}\mathrel{=}\Conid{FS}\mathbin{{<}{\$}{>}}\Varid{s}\;\Varid{i}{}\<[E]%
\ColumnHook
\end{pboxed}
\)\par\noindent\endgroup\resethooks

\begingroup\par\noindent\advance\leftskip\mathindent\(
\begin{pboxed}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{28}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\Varid{app}_{\Varid{TySub}}\mathbin{::}\Conid{TySub}\;\Varid{ty}\;\Varid{ty'}\to \Conid{Type}\;\Varid{ty}\to \Conid{Type}\;\Varid{ty'}{}\<[E]%
\\
\>[B]{}\Varid{app}_{\Varid{TySub}}\;\Varid{s}\;\Conid{TyVoid}{}\<[28]%
\>[28]{}\mathrel{=}\Conid{TyVoid}{}\<[E]%
\\
\>[B]{}\Varid{app}_{\Varid{TySub}}\;\Varid{s}\;(\Varid{a}:\rightarrow\Varid{b}){}\<[28]%
\>[28]{}\mathrel{=}\Varid{app}_{\Varid{TySub}}\;\Varid{s}\;\Varid{a}:\rightarrow\Varid{app}_{\Varid{TySub}}\;\Varid{s}\;\Varid{b}{}\<[E]%
\\
\>[B]{}\Varid{app}_{\Varid{TySub}}\;\Varid{s}\;(\Conid{TyForall}\;\Varid{k}\;\Varid{a}){}\<[28]%
\>[28]{}\mathrel{=}\Conid{TyForall}\;\Varid{k}\;(\Varid{app}_{\Varid{TySub}}\;(\Varid{ext}_{\Varid{TySub}}\;\Varid{s})\;\Varid{a}){}\<[E]%
\\
\>[B]{}\Varid{app}_{\Varid{TySub}}\;\Varid{s}\;(\Conid{TyVar}\;\Varid{i}){}\<[28]%
\>[28]{}\mathrel{=}\Varid{s}\;\Varid{i}{}\<[E]%
\\
\>[B]{}\Varid{app}_{\Varid{TySub}}\;\Varid{s}\;(\Conid{TyLam}\;\Varid{a}){}\<[28]%
\>[28]{}\mathrel{=}\Conid{TyLam}\;(\Varid{app}_{\Varid{TySub}}\;(\Varid{ext}_{\Varid{TySub}}\;\Varid{s})\;\Varid{a}){}\<[E]%
\\
\>[B]{}\Varid{app}_{\Varid{TySub}}\;\Varid{s}\;(\Conid{TyApp}\;\Varid{a}\;\Varid{b}\;\Varid{k}){}\<[28]%
\>[28]{}\mathrel{=}\Conid{TyApp}\;(\Varid{app}_{\Varid{TySub}}\;\Varid{s}\;\Varid{a})\;(\Varid{app}_{\Varid{TySub}}\;\Varid{s}\;\Varid{b})\;\Varid{k}{}\<[E]%
\ColumnHook
\end{pboxed}
\)\par\noindent\endgroup\resethooks

\begingroup\par\noindent\advance\leftskip\mathindent\(
\begin{pboxed}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\mathbf{pattern}\;\Conid{TyRed}\;\Varid{a}\;\Varid{b}\;\Varid{k}\mathrel{=}\Conid{TyApp}\;(\Conid{TyLam}\;\Varid{a})\;\Varid{b}\;\Varid{k}{}\<[E]%
\ColumnHook
\end{pboxed}
\)\par\noindent\endgroup\resethooks

\begingroup\par\noindent\advance\leftskip\mathindent\(
\begin{pboxed}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{3}{@{}>{\hspre}l<{\hspost}@{}}%
\column{31}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\Varid{step}_{\Varid{Ty}}\mathbin{::}\Conid{Type}\;\Varid{ty}\to \Conid{Maybe}\;(\Conid{Type}\;\Varid{ty}){}\<[E]%
\\
\>[B]{}\Varid{step}_{\Varid{Ty}}\;\Conid{TyVoid}{}\<[31]%
\>[31]{}\mathrel{=}\Varid{empty}{}\<[E]%
\\
\>[B]{}\Varid{step}_{\Varid{Ty}}\;(\Varid{a}:\rightarrow\Varid{b}){}\<[31]%
\>[31]{}\mathrel{=}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}((:\rightarrow)\mathbin{{<}{\$}{>}}\Varid{step}_{\Varid{Ty}}\;\Varid{a}\mathbin{{<}{*}{>}}\Varid{pure}\;\Varid{b})\mathbin{{<}{\vert}{>}}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}((:\rightarrow)\mathbin{{<}{\$}{>}}\Varid{pure}\;\Varid{a}\mathbin{{<}{*}{>}}\Varid{step}_{\Varid{Ty}}\;\Varid{b}){}\<[E]%
\\
\>[B]{}\Varid{step}_{\Varid{Ty}}\;(\Conid{TyForall}\;\Varid{k}\;\Varid{a}){}\<[31]%
\>[31]{}\mathrel{=}\Conid{TyForall}\mathbin{{<}{\$}{>}}\Varid{pure}\;\Varid{k}\mathbin{{<}{*}{>}}\Varid{step}_{\Varid{Ty}}\;\Varid{a}{}\<[E]%
\\
\>[B]{}\Varid{step}_{\Varid{Ty}}\;(\Conid{TyLam}\;\Varid{a}){}\<[31]%
\>[31]{}\mathrel{=}\Conid{TyLam}\mathbin{{<}{\$}{>}}\Varid{step}_{\Varid{Ty}}\;\Varid{a}{}\<[E]%
\\
\>[B]{}\Varid{step}_{\Varid{Ty}}\;(\Conid{TyVar}\;\Varid{i}){}\<[31]%
\>[31]{}\mathrel{=}\Varid{empty}{}\<[E]%
\\
\>[B]{}\Varid{step}_{\Varid{Ty}}\;(\Conid{TyRed}\;\Varid{a}\;\Varid{b}\;\Varid{k}){}\<[31]%
\>[31]{}\mathrel{=}\Varid{pure}\;(\Varid{app}_{\Varid{TySub}}\;(\Varid{fromS}\;\Varid{b}\;\Conid{TyVar})\;\Varid{a}){}\<[E]%
\\
\>[B]{}\Varid{step}_{\Varid{Ty}}\;(\Conid{TyApp}\;\Varid{a}\;\Varid{b}\;\Varid{k}){}\<[31]%
\>[31]{}\mathrel{=}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}(\Conid{TyApp}\mathbin{{<}{\$}{>}}\Varid{step}_{\Varid{Ty}}\;\Varid{a}\mathbin{{<}{*}{>}}\Varid{pure}\;\Varid{b}\mathbin{{<}{*}{>}}\Varid{pure}\;\Varid{k})\mathbin{{<}{\vert}{>}}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}(\Conid{TyApp}\mathbin{{<}{\$}{>}}\Varid{pure}\;\Varid{a}\mathbin{{<}{*}{>}}\Varid{step}_{\Varid{Ty}}\;\Varid{b}\mathbin{{<}{*}{>}}\Varid{pure}\;\Varid{k}){}\<[E]%
\ColumnHook
\end{pboxed}
\)\par\noindent\endgroup\resethooks

\begingroup\par\noindent\advance\leftskip\mathindent\(
\begin{pboxed}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\Varid{norm}_{\Varid{Ty}}\mathbin{::}\Conid{Type}\;\Varid{ty}\to \Conid{Type}\;\Varid{ty}{}\<[E]%
\\
\>[B]{}\Varid{norm}_{\Varid{Ty}}\;\Varid{a}\mathrel{=}\Varid{maybe}\;\Varid{a}\;\Varid{norm}_{\Varid{Ty}}\;(\Varid{step}_{\Varid{Ty}}\;\Varid{a}){}\<[E]%
\ColumnHook
\end{pboxed}
\)\par\noindent\endgroup\resethooks


\subsection{Terms}

\begingroup\par\noindent\advance\leftskip\mathindent\(
\begin{pboxed}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{4}{@{}>{\hspre}c<{\hspost}@{}}%
\column{4E}{@{}l@{}}%
\column{7}{@{}>{\hspre}l<{\hspost}@{}}%
\column{12}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\mathbf{data}\;{}\<[7]%
\>[7]{}\Conid{Term}\;\Varid{ty}\;\Varid{tm}{}\<[E]%
\\
\>[B]{}\hsindent{4}{}\<[4]%
\>[4]{}\mathrel{=}{}\<[4E]%
\>[7]{}\Conid{Var}\;{}\<[12]%
\>[12]{}\Varid{tm}{}\<[E]%
\\
\>[B]{}\hsindent{4}{}\<[4]%
\>[4]{}\mid {}\<[4E]%
\>[7]{}\Conid{Lam}\;{}\<[12]%
\>[12]{}(\Conid{Term}\;\Varid{ty}\;(\Conid{S}\;\Varid{tm})){}\<[E]%
\\
\>[B]{}\hsindent{4}{}\<[4]%
\>[4]{}\mid {}\<[4E]%
\>[7]{}\Conid{App}\;{}\<[12]%
\>[12]{}(\Conid{Term}\;\Varid{ty}\;\Varid{tm})\;{}\<[E]%
\\
\>[12]{}(\Conid{Term}\;\Varid{ty}\;\Varid{tm})\;{}\<[E]%
\\
\>[12]{}(\Conid{Normal}\;(\Conid{Type}\;\Varid{ty})){}\<[E]%
\\
\>[B]{}\hsindent{4}{}\<[4]%
\>[4]{}\mid {}\<[4E]%
\>[7]{}\Conid{LAM}\;{}\<[12]%
\>[12]{}(\Conid{Term}\;(\Conid{S}\;\Varid{ty})\;\Varid{tm}){}\<[E]%
\\
\>[B]{}\hsindent{4}{}\<[4]%
\>[4]{}\mid {}\<[4E]%
\>[7]{}\Conid{APP}\;{}\<[12]%
\>[12]{}(\Conid{Term}\;\Varid{ty}\;\Varid{tm})\;{}\<[E]%
\\
\>[12]{}(\Conid{Normal}\;(\Conid{Type}\;(\Conid{S}\;\Varid{ty})))\;{}\<[E]%
\\
\>[12]{}(\Conid{Normal}\;(\Conid{Type}\;\Varid{ty}))\;{}\<[E]%
\\
\>[12]{}\Conid{Kind}{}\<[E]%
\ColumnHook
\end{pboxed}
\)\par\noindent\endgroup\resethooks
\begin{comment}
\begingroup\par\noindent\advance\leftskip\mathindent\(
\begin{pboxed}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{4}{@{}>{\hspre}l<{\hspost}@{}}%
\column{19}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[4]{}\mathbf{deriving}\;(\Conid{Typeable},\Conid{Eq},\Conid{Show}){}\<[E]%
\\[\blanklineskip]%
\>[B]{}\Varid{deriveBifunctor}\;{}\<[19]%
\>[19]{}\text{\ttfamily ''}\;\Conid{Term}{}\<[E]%
\\
\>[B]{}\Varid{deriveEnumerable}\;{}\<[19]%
\>[19]{}\text{\ttfamily ''}\;\Conid{Term}{}\<[E]%
\ColumnHook
\end{pboxed}
\)\par\noindent\endgroup\resethooks
\end{comment}


\subsection{Type Checking}

\begingroup\par\noindent\advance\leftskip\mathindent\(
\begin{pboxed}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\mathbf{type}\;\Conid{TyEnv}\;\Varid{ty}\;\Varid{tm}\mathrel{=}\Varid{tm}\to \Conid{Type}\;\Varid{ty}{}\<[E]%
\ColumnHook
\end{pboxed}
\)\par\noindent\endgroup\resethooks

\begingroup\par\noindent\advance\leftskip\mathindent\(
\begin{pboxed}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{20}{@{}>{\hspre}l<{\hspost}@{}}%
\column{28}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\Varid{ext}_{\Varid{TyEnv}}\mathbin{::}\Conid{Type}\;\Varid{ty}\to \Conid{TyEnv}\;\Varid{ty}\;\Varid{tm}\to \Conid{TyEnv}\;\Varid{ty}\;(\Conid{S}\;\Varid{tm}){}\<[E]%
\\
\>[B]{}\Varid{ext}_{\Varid{TyEnv}}\;\Varid{a}\;\Varid{typeOf}\;{}\<[20]%
\>[20]{}\Conid{FZ}{}\<[28]%
\>[28]{}\mathrel{=}\Varid{a}{}\<[E]%
\\
\>[B]{}\Varid{ext}_{\Varid{TyEnv}}\;\Varid{a}\;\Varid{typeOf}\;{}\<[20]%
\>[20]{}(\Conid{FS}\;\Varid{n}){}\<[28]%
\>[28]{}\mathrel{=}\Varid{typeOf}\;\Varid{n}{}\<[E]%
\ColumnHook
\end{pboxed}
\)\par\noindent\endgroup\resethooks

\begingroup\par\noindent\advance\leftskip\mathindent\(
\begin{pboxed}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\Varid{raise}_{\Varid{TyEnv}}\mathbin{::}\Conid{TyEnv}\;\Varid{ty}\;\Varid{tm}\to \Conid{TyEnv}\;(\Conid{S}\;\Varid{ty})\;\Varid{tm}{}\<[E]%
\\
\>[B]{}\Varid{raise}_{\Varid{TyEnv}}\;\Varid{typeOf}\;\Varid{n}\mathrel{=}\Conid{FS}\mathbin{{<}{\$}{>}}\Varid{typeOf}\;\Varid{n}{}\<[E]%
\ColumnHook
\end{pboxed}
\)\par\noindent\endgroup\resethooks

\begingroup\par\noindent\advance\leftskip\mathindent\(
\begin{pboxed}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{3}{@{}>{\hspre}l<{\hspost}@{}}%
\column{5}{@{}>{\hspre}l<{\hspost}@{}}%
\column{13}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\Varid{check}_{\Varid{Tm}}\mathbin{::}{}\<[13]%
\>[13]{}\Conid{Eq}\;\Varid{ty}\Rightarrow \Conid{Type}\;\Varid{ty}\to \Conid{Term}\;\Varid{ty}\;\Varid{tm}\to {}\<[E]%
\\
\>[13]{}\Conid{Reader}\;(\Conid{KindEnv}\;\Varid{ty},\Conid{TyEnv}\;\Varid{ty}\;\Varid{tm})\;\Conid{Cool}{}\<[E]%
\\
\>[B]{}\Varid{check}_{\Varid{Tm}}\;\Varid{a}\;(\Conid{Var}\;\Varid{n})\mathrel{=}\mathbf{do}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}(\Varid{kindOf},\Varid{typeOf})\leftarrow \Varid{ask}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\Varid{return}\;(\Varid{toCool}\;(\Varid{a}\equiv \Varid{typeOf}\;\Varid{n})){}\<[E]%
\\
\>[B]{}\Varid{check}_{\Varid{Tm}}\;(\Varid{a}:\rightarrow\Varid{b})\;(\Conid{Lam}\;\Varid{x})\mathrel{=}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\Varid{withReader}\;(\Varid{bimap}\;\Varid{id}\;(\Varid{ext}_{\Varid{TyEnv}}\;\Varid{a}))\mathbin{\$}{}\<[E]%
\\
\>[3]{}\hsindent{2}{}\<[5]%
\>[5]{}\Varid{check}_{\Varid{Tm}}\;\Varid{b}\;\Varid{x}{}\<[E]%
\\
\>[B]{}\Varid{check}_{\Varid{Tm}}\;\Varid{b}\;(\Conid{App}\;\Varid{x}\;\Varid{y}\;(\Conid{Normal}\;\Varid{a}))\mathrel{=}\mathbf{do}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\Varid{xOk}\leftarrow \Varid{check}_{\Varid{Tm}}\;(\Varid{a}:\rightarrow\Varid{b})\;\Varid{x}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\Varid{yOk}\leftarrow \Varid{check}_{\Varid{Tm}}\;\Varid{a}\;\Varid{y}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\Varid{return}\;(\Varid{xOk}\land\Varid{yOk}){}\<[E]%
\\
\>[B]{}\Varid{check}_{\Varid{Tm}}\;(\Conid{TyForall}\;\Varid{k}\;\Varid{a})\;(\Conid{LAM}\;\Varid{x})\mathrel{=}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\Varid{withReader}\;(\Varid{bimap}\;(\Varid{ext}_{\Varid{KindEnv}}\;\Varid{k})\;\Varid{raise}_{\Varid{TyEnv}})\mathbin{\$}{}\<[E]%
\\
\>[3]{}\hsindent{2}{}\<[5]%
\>[5]{}\Varid{check}_{\Varid{Tm}}\;\Varid{a}\;\Varid{x}{}\<[E]%
\\
\>[B]{}\Varid{check}_{\Varid{Tm}}\;\Varid{c}\;(\Conid{APP}\;\Varid{x}\;(\Conid{Normal}\;\Varid{a})\;(\Conid{Normal}\;\Varid{b})\;\Varid{k})\mathrel{=}\mathbf{do}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\Varid{xOk}\leftarrow \Varid{check}_{\Varid{Tm}}\;(\Conid{TyForall}\;\Varid{k}\;\Varid{a})\;\Varid{x}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\Varid{yOk}\leftarrow \Varid{withReader}\;\Varid{fst}\;(\Varid{check}_{\Varid{Ty}}\;\Varid{k}\;\Varid{b}){}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\Varid{return}\;(\Varid{xOk}\land\Varid{yOk}\land\Varid{c}\equiv \Varid{norm}_{\Varid{Ty}}\;(\Conid{TyRed}\;\Varid{a}\;\Varid{b}\;\Varid{k})){}\<[E]%
\\
\>[B]{}\Varid{check}_{\Varid{Tm}}\;\anonymous \;\anonymous \mathrel{=}\Varid{pure}\;\Varid{False}{}\<[E]%
\ColumnHook
\end{pboxed}
\)\par\noindent\endgroup\resethooks

\begingroup\par\noindent\advance\leftskip\mathindent\(
\begin{pboxed}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{3}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\Varid{check}_{\Varid{ClosedTm}}\mathbin{::}\Conid{Type}\;\Conid{Z}\to \Conid{Term}\;\Conid{Z}\;\Conid{Z}\to \Conid{Cool}{}\<[E]%
\\
\>[B]{}\Varid{check}_{\Varid{ClosedTm}}\;\Varid{a}\;\Varid{x}\mathrel{=}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\Varid{runReader}\;(\Varid{check}_{\Varid{Tm}}\;\Varid{a}\;\Varid{x})\;(\Varid{fromZ},\Varid{fromZ}){}\<[E]%
\ColumnHook
\end{pboxed}
\)\par\noindent\endgroup\resethooks


\subsubsection{Enumerating System F\textomega}

\begingroup\par\noindent\advance\leftskip\mathindent\(
\begin{pboxed}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\Varid{polygen}\mathbin{::}\Conid{Int}\to \Conid{Type}\;\Conid{Z}\to \Conid{IO}\;[\mskip1.5mu \Conid{Term}\;\Conid{Z}\;\Conid{Z}\mskip1.5mu]{}\<[E]%
\\
\>[B]{}\Varid{polygen}\;\Varid{depth}\;\Varid{a}\mathrel{=}\Varid{search}\;\Varid{depth}\;(\Varid{check}_{\Varid{ClosedTm}}\;\Varid{a}){}\<[E]%
\ColumnHook
\end{pboxed}
\)\par\noindent\endgroup\resethooks

\begin{comment}
\begingroup\par\noindent\advance\leftskip\mathindent\(
\begin{pboxed}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{3}{@{}>{\hspre}l<{\hspost}@{}}%
\column{5}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\Varid{main}\mathbin{::}\Conid{IO}\;(){}\<[E]%
\\
\>[B]{}\Varid{main}\mathrel{=}\mathbf{do}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\Varid{args}\leftarrow \Varid{getArgs}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\mathbf{case}\;(\Varid{length}\;\Varid{args},\Varid{read}\;(\Varid{args}\mathbin{!!}\mathrm{0}),\Varid{read}\;(\Varid{args}\mathbin{!!}\mathrm{1}))\;\mathbf{of}{}\<[E]%
\\
\>[3]{}\hsindent{2}{}\<[5]%
\>[5]{}(\mathrm{2},\Varid{d},\Varid{a})\to \Varid{mapM\char95 }\;\Varid{print}\rbind \Varid{polygen}\;\Varid{d}\;\Varid{a}{}\<[E]%
\\
\>[3]{}\hsindent{2}{}\<[5]%
\>[5]{}(\anonymous ,\anonymous ,\anonymous )\to \Varid{putStrLn}\;\text{\ttfamily \char34 usage:~polygen~[depth]~[type]\char34}{}\<[E]%
\ColumnHook
\end{pboxed}
\)\par\noindent\endgroup\resethooks
\end{comment}

%% Acknowledgments
\begin{acks}
\end{acks}

%% Bibliography
\bibliography{bibfile}

%% Appendix
\appendix
\section{Appendix}

Text of appendix \ldots

\end{document}
